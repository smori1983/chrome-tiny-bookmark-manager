/*!
 * smodules.js v0.1
 *
 * Copyright (c) 2012 smori <smori1983@gmail.com>
 * Dual licensed under the MIT or GPL-2.0 licenses.
 *
 * Date 2012-06-15 03:42:38
 */
var smodules={};smodules.ui={},smodules.util={},smodules.ui.hasId=function(a,b,c,d){var e=a.target;$(e).attr("id")===b?c(e):typeof d=="function"&&d(e)},smodules.ui.hasClass=function(a,b,c,d){var e=a.target;$(e).hasClass(b)?c(e):typeof d=="function"&&d(e)},smodules.ui.tab=function(){var a=function(a,b){var c=a.target;c.tagName==="A"&&b(c)},b=function(a,b){$("#"+a.id).find("a").each(function(c,d){d===b?($(d).addClass(a.selected),$($(d).attr("href")).show()):($(d).removeClass(a.selected),$($(d).attr("href")).hide())})};return function(c){if(typeof c.id!="string")return;return c=$.extend({mouseover:"mouse",selected:"selected",initial:0},c),$("#"+c.id).click(function(d){a(d,function(a){b(c,a),d.preventDefault()})}).mouseover(function(b){a(b,function(a){$(a).addClass(c.mouseover)})}).mouseout(function(b){a(b,function(a){$(a).removeClass(c.mouseover)})}),$("#"+c.id).find("a").eq(c.initial).click(),smodules.ui}}(),smodules.templateParser=function(){var a={},b,c,d,e,f,g,h,i=function(a){throw new Error("smodules.templateParser - "+a+" in source "+b+" ["+g+","+h+"]")},j=function(a,b){var f=function(a){while(a.length>0)a.slice(0,1)==="\n"?(g++,h=1):h++,a=a.slice(1)};return function(a,b){return a=a||e,c.indexOf(a,d)!==d&&i("syntax error"),f(a),d+=a.length,e=c.charAt(d),b||a}}(),k=function(){var a="";while(/\s/.test(e))a+=j(e);return a},l=function(a){return c.indexOf(a,d)===d},m=function(a){return a.test(c.slice(d))},n=function(){return m(/^\{\s*left\s*\}/)},o=function(){return j("{"),k(),j("left"),k(),j("}"),"{"},p=function(){return m(/^\{\s*right\s*\}/)},q=function(){return j("{"),k(),j("right"),k(),j("}"),"}"},r=function(){return m(/^\{\s*literal\s*\}/)},s=function(){return j("{"),k(),j("literal"),k(),j("}"),"{literal}"},t=function(){return m(/^\{\s*\/\s*literal\s*\}/)},u=function(){return j("{"),k(),j("/"),k(),j("literal"),k(),j("}"),"{/literal}"},v=function(){return m(/^\{\s*if\s/)},w=function(){return j("{"),k(),j("if"),k(),"{if "},x=function(){return m(/^\{\s*elseif\s/)},y=function(){return j("{"),k(),j("elseif"),k(),"{elseif "},z=function(){return m(/^\{\s*else\s*\}/)},A=function(){return j("{"),k(),j("else"),k(),j("}"),"{else}"},B=function(){return m(/^\{\s*\/\s*if\s*\}/)},C=function(){return j("{"),k(),j("/"),k(),j("if"),k(),j("}"),"{/if}"},D=function(){return m(/^\{\s*for\s/)},E=function(){return j("{"),k(),j("for"),k(),"{for "},F=function(){return m(/^\{\s*\/\s*for\s*\}/)},G=function(){return j("{"),k(),j("/"),k(),j("for"),k(),j("}"),"{/for}"},H=function(){return m(/^\{\s*\$/)},I=function(){return m(/^\$\w+[^\w]/)},J=function(){var a=j("$");while(/\w/.test(e))a+=j(e);return a==="$"&&i("tmp variable not found"),a.slice(1)},K=function(){return m(/^\$\w+(?:\.\w+)*(?:[^\w]|$)/)},L=function(){var a=j("$");while(/[\w\.]/.test(e))a+=j(e);return a==="$"?i("variable not found"):/^\$\.|\.$|\.\./.test(a)&&i("invalid variable expression"),{type:"var",expr:a,keys:a.slice(1).split(".")}},M=function(){return m(/^null[^\w]/)},N=function(){return{type:"value",expr:j("null"),value:null}},O=function(){return m(/^true[^\w]/)},P=function(){return{type:"value",expr:j("true"),value:!0}},Q=function(){return m(/^false[^\w]/)},R=function(){return{type:"value",expr:j("false"),value:!1}},S=function(){return e==="'"||e==='"'},T=function(){var a;if(a=c.slice(d).match(/^(["'])(?:\\\1|\s|\S)*?\1/))return j(a[0]),{type:"value",expr:a[0],value:a[0].slice(1,-1).replace("\\"+a[1],a[1])};i("string expression not closed")},U=function(){return e==="+"||e==="-"||e>="0"&&e<="9"},V=function(){var a,b=c.slice(d).match(/^[\+\-]?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][\+\-]?\d+)?/);if(b&&!isNaN(a=+b[0]))return j(b[0]),{type:"value",expr:b[0],value:a};i("invalid number expression")},W=function(){return M()||O()||Q()||S()||U()},X=function(){if(M())return N();if(O())return P();if(Q())return R();if(S())return T();if(U())return V();i("value shoud be written")},Y=function(){return m(/^(and|or)[^\w]/)},Z=function(){var a;return l("and")?a=j("and"):l("or")?a=j("or"):i("'and' or 'or' should be written"),{type:"andor",expr:a}},$=/^(?:lte|lt|gte|gt|===|==|!==|!=)/,_=function(){return m($)},ba=function(){var a;return(a=c.slice(d).match($))?expr=j(a[0]):i("comparer should be written"),{type:"comp",expr:expr}},bb=function(){return e==="("},bc=function(){return{type:"roundBracket",expr:j("(")}},bd=function(){return e===")"},be=function(){return{type:"endRoundBracket",expr:j(")")}},bf=function(){var a=function(){var a={start:["roundBracket","value","var","error"],roundBracket:["roundBracket","value","var","error"],endRoundBracket:["endRoundBracket","andor","error"],value:["endRoundBracket","comp","andor","error"],"var":["endRoundBracket","comp","andor","error"],comp:["value","var","error"],andor:["roundBracket","value","var","error"]},b={roundBracket:{read:bb,parse:bc},endRoundBracket:{read:bd,parse:be},value:{read:W,parse:X},"var":{read:K,parse:L},comp:{read:_,parse:ba},andor:{read:Y,parse:Z}},c=function(){var a;return{init:function(){a=["start"]},add:function(b){a.push(b)},get:function(b){return a[a.length-b]||null}}}(),g=function(){var a,b;return{init:function(){a=0,b=0},add:function(c){c==="var"||c==="value"?b++:c==="comp"||c==="andor"?b--:c==="roundBracket"?a++:c==="endRoundBracket"&&a--,a<0&&i("can not use ')' here")},finish:function(){a!==0&&i("invalid usage of round bracket"),b!==1&&i("invalid usage of operand or operator")}}}(),h=function(){var a={endRoundBracket:1,or:2,and:3,comp:4,value:5,"var":5,roundBracket:6};return function(b){return a[b.type]||a[b.expr]}}(),j=function(){var d=a[c.get(1)],e=0,f=d.length,h,j;for(;e<f;e++){h=d[e];if(h==="error")i("invalid condition expression");else if(b[h].read()){h==="comp"&&c.get(2)==="comp"&&i("can not write comparer here"),j=b[h].parse();break}}return c.add(j.type),g.add(j.type),j};return function(){var a,b=[],i=[],l;c.init(),g.init();while(d<f){if(e==="}")break;a=j(),a.order=h(a);while(i.length>0){l=i.pop();if(a.order<=l.order&&l.type!=="roundBracket")b.push(l);else{i.push(l);break}}a.type==="endRoundBracket"?i.pop():i.push(a),k()}while(i.length>0)b.push(i.pop());return g.finish(),b}}();return function(){var b,c=null;v()?(w(),b="if"):x()?(y(),b="elseif"):z()?(A(),b="else"):i("unknown condition expression");if(b==="if"||b==="elseif")c=a(),j("}");return{type:b,stack:c}}}(),bg=function(){var a="";while(d<f)if(e==="{")if(n())a+=o();else if(p())a+=q();else break;else a+=j(e);return{type:"normal",expr:a}},bh=function(){var a="",b=!1,c=g,k=h;s();while(d<f)if(e==="{")if(n())a+=o();else if(p())a+=q();else{if(t()){u(),b=!0;break}a+=j(e)}else a+=j(e);return b||i("literal block starts at ["+c+", "+k+"] not closed by {/literal}"),{type:"literal",expr:a}},bi=function(){var a=function(){var a=function(){var a="";k();while(/[\w\-]/.test(e))a+=j(e);return a===""&&i("filter name not found"),{expr:a,name:a}},b=function(){var a="",b=[],c;k();if(e===":"){a+=j(":");while(d<f){k(),e==="n"?c=N():e==="t"?c=P():e==="f"?c=R():e==="'"||e==='"'?c=T():e==="-"||e==="+"||e>="0"&&e<="9"?c=V():i("invalid filter args"),a+=c.expr,b.push(c.value),k();if(e===",")a+=j(",");else if(e==="|"||e==="}")break}}return{expr:a,args:b}},c=function(){var c="",g=[],h,k,l;while(d<f){h={},c+=j("|"),k=a(),c+=k.expr,h.name=k.name,l=b(),c+=l.expr,h.args=l.args,g.push(h);if(e==="}")break;e!=="|"&&i("syntax error")}return{expr:c,filters:g}};return function(){var a="",b=[],d;return k(),e==="|"&&(d=c(),a=d.expr,b=d.filters),{expr:a,filters:b}}}();return function(){var b="",c,d;return b+=j("{"),k(),c=L(),b+=c.expr,d=a(),b+=d.expr,b+=j("}"),{type:"holder",expr:b,keys:c.keys,filters:d.filters}}}(),bj=function(){var a=function(){var a=E(),b,c,d;return c=J(),a+=c,k(),e===","&&(b=c,a+=j(","),k(),c=J(),a+=c,k()),a+=" ",m(/^in\s/)||i("invalid for expression"),a+=j("in"),k(),d=L(),a+=d.expr,k(),a+=j("}"),{expr:a,k:b,v:c,array:d.keys}};return function(){var b=a(),c=bl([],!0);return G(),{type:"for",header:b,blocks:c}}}(),bk=function(){var a=[];while(v()||x()||z())a.push({header:bf(),blocks:bl([],!0)});return C(),{type:"if",sections:a}},bl=function(a,b){while(d<f)if(e==="{"){if(b&&(x()||z()||B()||F()))break;r()?a.push(bh()):v()?a.push(bk()):D()?a.push(bj()):H()?a.push(bi()):a.push(bg())}else a.push(bg());return a};return a.parse=function(a,i){var j=[];return b=i||"",c=a,d=0,e=a.charAt(0),f=a.length,g=1,h=1,bl([])},a}(),smodules.util.console=function(){var a={},b=!1;return a.on=function(){return b=!0,a},a.off=function(){return b=!1,a},a.log=function(c){return b&&console.log(c),a},a.time=function(c){return b&&console.time(c),a},a.timeEnd=function(c){return b&&console.timeEnd(c),a},a}(),smodules.template=function(){var a={},b={},c=function(a){return/\.html$/.test(a)},d=function(a){return a.indexOf("#")===0},e=function(a,c){b[a]=smodules.templateParser.parse(c,a)},f=function(a,b){$.ajax({url:a,success:function(c){e(a,c),typeof b=="function"&&b()}})},g=function(a,b){$(a)[0].tagName.toLowerCase()==="textarea"?e(a,$(a).val()):e(a,$(a).html()),typeof b=="function"&&b()},h=function(a,b){e(a,a),typeof b=="function"&&b()},i=function(a,e,i){b.hasOwnProperty(a)?j(a,e,i):c(a)?f(a,function(){j(a,e,i)}):d(a)?g(a,function(){j(a,e,i)}):h(a,function(){j(a,e,i)})},j=function(a,b,c){$.isArray(b)||(b=[b]),$.each(b,function(b,d){c(k(a,d))})},k=function(){var c,d=function(a){throw new Error("smodules.template - "+a+" in source "+c)},e=function(a,b,c){var d=b.length-1,e,f=a.length,g;for(;d>=0;d--){g=b[d];for(e=0;e<f;e++){if(typeof g[a[e]]=="undefined"){g=null;break}g=g[a[e]]}if(e===f)break}return c?g:g===null?"":g.toString()},f=function(b){if(typeof a[b]=="function")return a[b];d("filter '"+b+"' not found")},g=function(a,b){return b.forEach(function(b){a=f(b.name).apply(null,[a].concat(b.args))}),a},h=function(a,b){return a.reduce(function(a,c){return c.type==="normal"||c.type==="literal"?a+c.expr:c.type==="holder"?a+g(e(c.keys,b),c.filters):c.type==="if"?a+l(c,b):c.type==="for"?a+m(c,b):a},"")},i=function(a,b,c){if(c==="===")return a===b;if(c==="==")return a==b;if(c==="!==")return a!==b;if(c==="!=")return a!=b;if(c==="lte")return a<=b;if(c==="lt")return a<b;if(c==="gte")return a>=b;if(c==="gt")return a>b;d("invalid comparer")},j=function(a,b,c){if(c==="and")return a&&b;if(c==="or")return a||b;d("unknown operator")},k=function(a,b){var c=[],f=0,g=a.length,h,k,l;for(;f<g;f++)h=a[f],h.type==="value"?c.push(h.value||h.expr):h.type==="var"?c.push(e(h.keys,b,!0)):h.type==="comp"?(l=c.pop(),k=c.pop(),c.push(i(k,l,h.expr))):h.type==="andor"&&(l=c.pop(),k=c.pop(),c.push(j(k,l,h.expr)));return c.length!==1&&d("invalid condition expression"),c[0]},l=function(a,b){var c=0,d=a.sections.length,e,f,g="";for(;c<d;c++){e=a.sections[c];if(e.header.type==="if"||e.header.type==="elseif"){if(f=k(e.header.stack,b)){g=h(e.blocks,b);break}}else g=h(e.blocks,b)}return g},m=function(a,b){var c=e(a.header.array,b,!0),d="",f;return $.isArray(c)&&c.forEach(function(c,e){f={},a.header.k&&(f[a.header.k]=e),f[a.header.v]=c,b.push(f),d+=h(a.blocks,b),b.pop()}),d};return function(a,d){return c=a,h(b[a],[d])}}(),l=function(a,b){return{get:function(c){i(a,b,function(a){c(a)})},appendTo:function(c){i(a,b,function(a){$(a).appendTo(c)})},insertBefore:function(c){i(a,b,function(a){$(a).insertBefore(c)})}}};return l.addFilter=function(b,c){return a[b]=c,l},l.preFetch=function(a){return c(a)?f(a):d(a)?g(a):h(a),l},l}(),smodules.template.addFilter("h",function(){var a={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#039;"};return function(b){return b.replace(/[<>&"']/g,function(b){return a[b]})}}()),smodules.template.addFilter("default",function(a,b){return a.length===0?b:a}),smodules.template.addFilter("upper",function(a){return a.toLocaleUpperCase()}),smodules.template.addFilter("lower",function(a){return a.toLocaleLowerCase()}),smodules.template.addFilter("plus",function(a,b){return isFinite(a)&&typeof b=="number"&&isFinite(b)?(+a+b).toString():a}),smodules.storage=function(){var a={};return a.get=function(a,b){var c=localStorage.getItem(a);return typeof b=="undefined"?c:c===null?b:c},a.getJSON=function(a,b){var c=localStorage.getItem(a);return typeof b=="undefined"?c===null?{}:JSON.parse(c):c===null?b:JSON.parse(c)},a.set=function(a,b){localStorage.setItem(a,b)},a.setJSON=function(a,b){localStorage.setItem(a,JSON.stringify(b))},a}();